<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Mi Biblioteca - Modificar Datos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center">
    <!-- Header -->
    <header class="w-full bg-blue-600 text-white py-4 px-6 flex justify-between items-center shadow-md">
        <h1 class="text-xl font-semibold">Mi Biblioteca</h1>
        <button id="logout-button" onclick="logout()" class="bg-blue-800 px-4 py-2 rounded-lg hover:bg-blue-700 transition">
            Cerrar sesión
        </button>
    </header>

    <!-- Main Content -->
    <main class="w-full max-w-4xl bg-white rounded-lg shadow-lg p-6 mt-6">
        <h2 class="text-2xl font-bold text-gray-800 mb-4">Modificar Datos de Administrador</h2>
        
        <!-- Formulario de Modificación de Datos -->
        <form id="edit-user-form" class="space-y-6" onsubmit="submitForm(event)">
            <div>
                <label for="username" class="block text-gray-700 font-semibold">Nombre de Usuario</label>
                <input type="text" id="username" class="mt-2 w-full p-3 border border-gray-300 rounded-lg" placeholder="Nuevo nombre de usuario">
            </div>

            <div>
                <label for="email" class="block text-gray-700 font-semibold">Correo Electrónico</label>
                <input type="email" id="email" class="mt-2 w-full p-3 border border-gray-300 rounded-lg" placeholder="Nuevo correo electrónico">
            </div>

            <div>
                <label for="password" class="block text-gray-700 font-semibold">Contraseña</label>
                <input type="password" id="password" class="mt-2 w-full p-3 border border-gray-300 rounded-lg" placeholder="Nueva contraseña">
            </div>

            <button type="submit" class="w-full bg-blue-600 px-4 py-2 rounded-lg text-white hover:bg-blue-500 transition">
                Guardar Cambios
            </button>
        </form>
    </main>

    <!-- Scripts 
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const userId = sessionStorage.getItem('userId');
            console.log('User ID:', userId);  // Verifica si el userId es correcto

            if (!userId) {
                window.location.href = '/html/index.html'; // Si no hay userId, redirige al login
            } else {
                loadUserInfo(userId);
            }
        });

        async function loadUserInfo(userId) {
            try {
                const response = await fetch(`/usuario/${userId}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                });

                if (!response.ok) {
                    throw new Error('Error al cargar la información del usuario');
                }

                const data = await response.json();
                if (data.success) {
                    document.getElementById('username').value = data.user.nombre_usuario;
                    document.getElementById('email').value = data.user.email_usuario;
                    // No mostramos la contraseña, por razones de seguridad
                } else {
                    alert(data.error);
                    window.location.href = '/html/index.html';
                }
            } catch (error) {
                console.error('Error:', error.message);
                alert('Error al cargar la información del usuario');
            }
        }

        async function submitForm(event) {
            event.preventDefault(); // Evita que el formulario se envíe por defecto

            const userId = sessionStorage.getItem('userId');
            const username = document.getElementById('username').value;
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            const updatedData = {
                nombre_usuario: username,
                email_usuario: email,
                contraseña_usuario: password
            };

            try {
                const response = await fetch(`/usuario/${userId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(updatedData),
                });

                if (!response.ok) {
                    throw new Error('Error al actualizar los datos del usuario');
                }

                const data = await response.json();
                if (data.success) {
                    alert('Datos actualizados correctamente');
                    window.location.href = '/html/user-page.html'; // Redirige a la página de usuario
                } else {
                    alert(data.error);
                }
            } catch (error) {
                console.error('Error:', error.message);
                alert('Error al actualizar los datos');
            }
        }

        function logout() {
            sessionStorage.removeItem('userId');
            window.location.href = '/html/index.html'; // Redirige al login
        }
    </script> -->
</body>
</html>
